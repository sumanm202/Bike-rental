version: 1
services:
  - type: web
    name: bike-rental-web-jkgi
    env: python
    plan: free
    branch: main

    buildCommand: >
      bash -lc '
      # find a python executable available in this build image
      PY=$(command -v python3 || command -v python || command -v python3.13 || true);
      if [ -z "$PY" ]; then
        echo "No python binary found in PATH; failing build";
        exit 1;
      fi;
      echo "Using python: $PY";
      $PY -m pip install --upgrade pip setuptools wheel;
      $PY -m pip install -r requirements.txt;
      $PY manage.py migrate --noinput;
      $PY manage.py collectstatic --noinput
      '

    startCommand: >
      bash -lc '
      # pick a python executable for running gunicorn (if needed)
      PY=$(command -v python3 || command -v python || command -v python3.13 || true);
      if [ -z "$PY" ]; then
        echo "No python binary found at runtime; exiting";
        exit 1;
      fi;
      exec gunicorn config.wsgi:application --bind 0.0.0.0:$PORT
      '

    healthCheckPath: /

    envVars:
      - key: SECRET_KEY
        value: ""
        scope: private

      - key: DEBUG
        value: "False"
        scope: private

      - key: STRIPE_SECRET_KEY
        value: ""
        scope: private

      - key: STRIPE_PUBLISHABLE_KEY
        value: ""
        scope: private

      - key: STRIPE_WEBHOOK_SECRET
        value: ""
        scope: private

      - key: DATABASE_URL
        value: ""
        scope: private
